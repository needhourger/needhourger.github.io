<!doctype html><html lang=zh-CN><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=UTF-8><meta name=generator content="Hugo 0.152.2"><meta name=theme-color content="#16171d"><meta name=color-scheme content="light dark"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><title>ApeRAG架构分析 | Broken Memories</title><link rel=stylesheet href=/css/meme.min.2be3a9f6b61596f4a5eb5135fbf838b279ce16e4c7ce19868892bd1c757159c8.css><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js defer></script><script src=/js/meme.min.1d7f6616ee7476541be893a3026378627324ca64929fc2af71451f1378e0436e.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto+Serif+SC:wght@400;500;700&amp;family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Inter:wght@100..900&amp;family=Silkscreen:wght@700&amp;family=Noto+Sans+SC:wght@100..900&amp;family=ZCOOL+QingKe+HuangYou&amp;family=Doto:wght@900&amp;display=swap" media=print onload='this.media="all"'><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto+Serif+SC:wght@400;500;700&amp;family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&amp;family=Inter:wght@100..900&amp;family=Silkscreen:wght@700&amp;family=Noto+Sans+SC:wght@100..900&amp;family=ZCOOL+QingKe+HuangYou&amp;family=Doto:wght@900&amp;display=swap"></noscript><meta name=author content="Yuuki"><meta name=description content="Zero - ApeRAG 简介 ApeRAG 一个号称生产就绪的 GraphRAG 多模态 RAG 引擎。以下是其官网 https://rag.apecloud.com/
目前官方发布了 ApeRAG v0.5.0-alpha.14 版本，其结合了传统向量引擎，全文索引，GraphRAG，视觉索引，摘要索引等多个维度全方面的 RAG 混合检索能力，使用 MinerU 集成作为其增强型的文档处理。在部署方面，官方直接提供了生产级部署的能力：最简可通过 docker 完成基础部署，同时提供了 k8s 部署的实践指导。同时集成了 MCP 服务，提供三方 AI 助手和工具无缝集成访问知识库的能力。
"><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#2a6df4><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="Broken Memories"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="Broken Memories"><meta name=msapplication-starturl content="../../"><meta name=msapplication-TileColor content="#fff"><meta name=msapplication-TileImage content="../../icons/mstile-150x150.png"><link rel=manifest href=/manifest.json><link rel=canonical href=https://yuukisama.cc/code/aperag/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2025-10-21T14:08:55+08:00","dateModified":"2025-11-10T17:45:53+08:00","url":"https://yuukisama.cc/code/aperag/","headline":"ApeRAG架构分析","description":"Zero - ApeRAG 简介 ApeRAG 一个号称生产就绪的 GraphRAG 多模态 RAG 引擎。以下是其官网 https://rag.apecloud.com/\n目前官方发布了 ApeRAG v0.5.0-alpha.14 版本，其结合了传统向量引擎，全文索引，GraphRAG，视觉索引，摘要索引等多个维度全方面的 RAG 混合检索能力，使用 MinerU 集成作为其增强型的文档处理。在部署方面，官方直接提供了生产级部署的能力：最简可通过 docker 完成基础部署，同时提供了 k8s 部署的实践指导。同时集成了 MCP 服务，提供三方 AI 助手和工具无缝集成访问知识库的能力。\n","inLanguage":"zh-CN","articleSection":"code","wordCount":5764,"image":["https://yuukisama.cc/image.png"],"author":{"@type":"Person","description":"Your choice. You suffer.","email":"chainyuuki@gmail.com","image":"https://yuukisama.cc/icons/apple-touch-icon.png","url":"https://yuukisama.cc/","name":"Yuuki"},"license":"[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)","publisher":{"@type":"Organization","name":"Broken Memories","logo":{"@type":"ImageObject","url":"https://yuukisama.cc/icons/apple-touch-icon.png"},"url":"https://yuukisama.cc/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://yuukisama.cc/"}}</script><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@yukiricc"><meta name=twitter:creator content="@yukiricc"><meta property="og:title" content="ApeRAG架构分析"><meta property="og:description" content="Zero - ApeRAG 简介 ApeRAG 一个号称生产就绪的 GraphRAG 多模态 RAG 引擎。以下是其官网 https://rag.apecloud.com/
目前官方发布了 ApeRAG v0.5.0-alpha.14 版本，其结合了传统向量引擎，全文索引，GraphRAG，视觉索引，摘要索引等多个维度全方面的 RAG 混合检索能力，使用 MinerU 集成作为其增强型的文档处理。在部署方面，官方直接提供了生产级部署的能力：最简可通过 docker 完成基础部署，同时提供了 k8s 部署的实践指导。同时集成了 MCP 服务，提供三方 AI 助手和工具无缝集成访问知识库的能力。
"><meta property="og:url" content="https://yuukisama.cc/code/aperag/"><meta property="og:site_name" content="Broken Memories"><meta property="og:locale" content="zh-cn"><meta property="og:image" content="https://yuukisama.cc/image.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2025-10-21T14:08:55+08:00"><meta property="article:modified_time" content="2025-11-10T17:45:53+08:00"><meta property="article:section" content="code"><link rel=preconnect href=https://www.google-analytics.com crossorigin><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-YSMKSWDEQK","auto"),ga("send","pageview")</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/ class=brand>Broken Memories</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=/><svg viewBox="0 0 576 512" class="icon home"><path d="M280.37 148.26 96 300.11V464a16 16 0 0016 16l112.06-.29a16 16 0 0015.92-16V368a16 16 0 0116-16h64a16 16 0 0116 16v95.64a16 16 0 0016 16.05L464 480a16 16 0 0016-16V3e2L295.67 148.26a12.19 12.19.0 00-15.3.0zM571.6 251.47 488 182.56V44.05a12 12 0 00-12-12h-56a12 12 0 00-12 12v72.61L318.47 43a48 48 0 00-61 0L4.34 251.47a12 12 0 00-1.6 16.9l25.5 31A12 12 0 0045.15 301l235.22-193.74a12.19 12.19.0 0115.3.0L530.9 301a12 12 0 0016.9-1.6l25.5-31a12 12 0 00-1.7-16.93z"/></svg><span class=menu-item-name>Home</span></a></li><li class=menu-item><a href=/categories/><svg viewBox="0 0 512 512" class="icon th"><path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255.0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255.0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256.0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255.0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256.0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255.0-24 10.745-24 24zm386.667-56H488c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255.0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255.0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255.0-24 10.745-24 24z"/></svg><span class=menu-item-name>Categories</span></a></li><li class=menu-item><a href=/tags/><svg viewBox="0 0 640 512" class="icon tags"><path d="M497.941 225.941 286.059 14.059A48 48 0 00252.118.0H48C21.49.0.0 21.49.0 48v204.118a48 48 0 0014.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882.0l204.118-204.118c18.745-18.745 18.745-49.137.0-67.882zM112 160c-26.51.0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882.0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397.0h48.721a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882z"/></svg><span class=menu-item-name>Tags</span></a></li><li class=menu-item><a href=/about/><svg viewBox="0 0 496 512" class="icon user-circle"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 96c48.6.0 88 39.4 88 88s-39.4 88-88 88-88-39.4-88-88 39.4-88 88-88zm0 344c-58.7.0-111.3-26.6-146.5-68.2 18.8-35.4 55.6-59.8 98.5-59.8 2.4.0 4.8.4 7.1 1.1 13 4.2 26.6 6.9 40.9 6.9s28-2.7 40.9-6.9c2.3-.7 4.7-1.1 7.1-1.1 42.9.0 79.7 24.4 98.5 59.8C359.3 421.4 306.7 448 248 448z"/></svg><span class=menu-item-name>About</span></a></li><li class=menu-item><a id=theme-switcher href=#><svg viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5 242 7a18 18 0 0128 0l48.8 97.5L422.2 70A18 18 0 01442 89.8l-34.5 103.4L505 242a18 18 0 010 28l-97.5 48.8L442 422.2A18 18 0 01422.2 442l-103.4-34.5L270 505a18 18 0 01-28 0l-48.8-97.5L89.8 442A18 18 0 0170 422.2l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8L70 89.8A18 18 0 0189.8 70zM256 128a128 128 0 10.01.0M256 160a96 96 0 10.01.0"/></svg><svg viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412A256 256 0 10181 5a11.5 11.5.0 00-5 20A201.5 201.5.0 0142 399a11.5 11.5.0 00-15 13"/></svg></a></li><li class="menu-item search-item"><form id=search class=search role=search><label for=search-input><svg viewBox="0 0 512 512" class="icon search-icon"><path d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></label>
<input type=search id=search-input class=search-input></form><template id=search-result hidden><article class="content post"><h2 class=post-title><a class=summary-title-link></a></h2><summary class=summary></summary><div class=read-more-container><a class=read-more-link>阅读更多 »</a></div></article></template></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label><label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-small-caps=true data-align=justify data-type=code data-toc-num=true><h1 class="post-title p-name">ApeRAG架构分析</h1><div class=post-meta><time datetime=2025-10-21T14:08:55+08:00 class="post-meta-item published dt-published"><svg viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2025.10.21</time>
<time datetime=2025-11-10T17:45:53+08:00 class="post-meta-item modified dt-updated"><svg viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M4e2 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627.0-12 5.373-12 12v52H48C21.49 64 0 85.49.0 112v352c0 26.51 21.49 48 48 48h352c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 4e2H54a6 6 0 01-6-6V160h352v298a6 6 0 01-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2025.11.10</time>
<span class="post-meta-item category"><svg viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>&nbsp;<a href=/code/ class="category-link p-category">code</a></span>
<span class="post-meta-item wordcount"><svg viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3.0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9.0l60.1 60.1c18.8 18.7 18.8 49.1.0 67.9zM284.2 99.8 21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3.0-17l-111-111c-4.8-4.7-12.4-4.7-17.1.0zM124.1 339.9c-5.5-5.5-5.5-14.3.0-19.8l154-154c5.5-5.5 14.3-5.5 19.8.0s5.5 14.3.0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8.0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;5764</span>
<span class="post-meta-item reading-time"><svg viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5.0-2e2-89.5-2e2-2e2S145.5 56 256 56s2e2 89.5 2e2 2e2-89.5 2e2-2e2 2e2zm61.8-104.4-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6.0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;12&nbsp;分钟</span>
<span class="post-meta-item busuanzi-page-pv" id=busuanzi_container_page_pv><svg viewBox="0 0 576 512" class="icon post-meta-icon"><path d="M288 144a110.94 110.94.0 00-31.24 5 55.4 55.4.0 017.24 27 56 56 0 01-56 56 55.4 55.4.0 01-27-7.24A111.71 111.71.0 10288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35.0 000 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35.0 000-29.19zM288 4e2c-98.65.0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 4e2 288 4e2z"/></svg>&nbsp;<span id=busuanzi_value_page_pv></span></span></div><nav class=contents><h2 id=contents class=contents-title>目录</h2><ol class=toc><li><a id=contents:zero---aperag-简介 href=#zero---aperag-简介>Zero - ApeRAG 简介</a></li><li><a id=contents:first---生产部署 href=#first---生产部署>First - 生产部署</a><ol><li><a id=contents:docker-部署 href=#docker-部署>Docker 部署</a></li><li><a id=contents:k8s-集群部署 href=#k8s-集群部署>K8s 集群部署</a></li></ol></li><li><a id=contents:second---特性简析 href=#second---特性简析>Second - 特性简析</a><ol><li><a id=contents:文档解析 href=#文档解析>文档解析</a></li><li><a id=contents:多种索引类型 href=#多种索引类型>多种索引类型</a><ol><li><a id=contents:向量索引-vector href=#向量索引-vector>向量索引 (Vector)</a></li><li><a id=contents:全文索引-full-text href=#全文索引-full-text>全文索引 (Full-Text)</a></li><li><a id=contents:graph-索引-graphrag href=#graph-索引-graphrag>Graph 索引 (GraphRAG)</a></li><li><a id=contents:摘要索引-summary-index href=#摘要索引-summary-index>摘要索引 (Summary Index)</a></li><li><a id=contents:视觉索引-vision-index href=#视觉索引-vision-index>视觉索引 (Vision Index)</a></li></ol></li><li><a id=contents:混合检索 href=#混合检索>混合检索</a><ol><li><a id=contents:vector-search-向量检索 href=#vector-search-向量检索>Vector Search 向量检索</a></li><li><a id=contents:fulltext-search-全文检索 href=#fulltext-search-全文检索>Fulltext Search 全文检索</a></li><li><a id=contents:summary-search-摘要检索 href=#summary-search-摘要检索>Summary Search 摘要检索</a></li><li><a id=contents:graphrag-检索 href=#graphrag-检索>GraphRAG 检索</a></li><li><a id=contents:vision-search-视觉检索 href=#vision-search-视觉检索>Vision Search 视觉检索</a></li><li><a id=contents:merge-节点 href=#merge-节点>Merge 节点</a></li><li><a id=contents:rerank-节点 href=#rerank-节点>Rerank 节点</a></li></ol></li></ol></li></ol></nav><div class="post-body e-content"><h2 id=zero---aperag-简介><a href=#zero---aperag-简介 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:zero---aperag-简介 class=headings>Zero - ApeRAG 简介</a></h2><p><a href=https://github.com/apecloud/ApeRAG target=_blank rel=noopener>ApeRAG</a> 一个号称生产就绪的 GraphRAG 多模态 RAG 引擎。以下是其官网 <a href=https://rag.apecloud.com/ target=_blank rel=noopener>https://rag.apecloud.com/</a></p><p>目前官方发布了 <a href=https://github.com/apecloud/ApeRAG/releases/tag/v0.5.0-alpha.14 target=_blank rel=noopener>ApeRAG v0.5.0-alpha.14</a> 版本，其结合了传统向量引擎，全文索引，GraphRAG，视觉索引，摘要索引等多个维度全方面的 RAG 混合检索能力，使用 MinerU 集成作为其增强型的文档处理。在部署方面，官方直接提供了生产级部署的能力：最简可通过 docker 完成基础部署，同时提供了 k8s 部署的实践指导。同时集成了 MCP 服务，提供三方 AI 助手和工具无缝集成访问知识库的能力。</p><blockquote><p>当然截止本文截稿，此项目 Github 大概 800+的 star 数目，目前尚处于开发与 alpha 测试阶段，其很多功能并未完善，例如官方独立提供部署的文档解析服务<a href=https://github.com/apecloud/doc-ray target=_blank rel=noopener>doc-ray</a>目前并不具备 K8s 下独立部署的能力，以及诸多的 API 功能在后端实现但是现有项目的 Web 端并未提供相关 UI 集成。</p></blockquote><h2 id=first---生产部署><a href=#first---生产部署 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:first---生产部署 class=headings>First - 生产部署</a></h2><h3 id=docker-部署><a href=#docker-部署 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:docker-部署 class=headings>Docker 部署</a></h3><ol><li>系统最低配置</li></ol><ul><li>双核 CPU</li><li>RAM 内存 >= 4 GiB</li><li>安装有 Docker 以及 Docker compose</li></ul><ol><li>使用 Git 工具克隆项目，然后使用 docker compose 命令一键启动。</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git clone https://github.com/apecloud/ApeRAG.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> ApeRAG
</span></span><span class=line><span class=cl>cp envs/env.template .env
</span></span><span class=line><span class=cl>docker-compose up -d --pull always
</span></span></code></pre></td></tr></table></div></div></div><ol><li>部署完成之后可以在浏览器中访问如下链接</li></ol><ul><li>Web 界面: <a href=http://localhost:3000/web/ target=_blank rel=noopener>http://localhost:3000/web/</a></li><li>API 文档：<a href=http://localhost:8000/docs target=_blank rel=noopener>http://localhost:8000/docs</a></li></ul><ol><li>ApeRAG 默认开启 MCP 集成，启动服务之后使用如下例子配置 MCP 的客户端,提供包括：知识库罗列，混合检索，智能查询等功能。</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;mcpServers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;aperag-mcp&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://localhost:8000/mcp/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;headers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;Authorization&#34;</span><span class=p>:</span> <span class=s2>&#34;Bearer your-api-key-here&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><h3 id=k8s-集群部署><a href=#k8s-集群部署 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:k8s-集群部署 class=headings>K8s 集群部署</a></h3><ol><li>克隆项目仓库以获得部署文件</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>git clone https://github.com/apecloud/ApeRAG.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> ApeRAG
</span></span></code></pre></td></tr></table></div></div></div><ol><li>部署数据库服务</li></ol><p>ApeRAG 需要 PostgreSQL、Redis、Qdrant 以及 Elasticsearch 等数据库，官方指导中提供了两个选择：</p><ul><li>使用既有数据库，如果生产环境中已经部署有上述数据库，可以基于<code>deploy/aperag/values.yaml</code>文件以配置数据库连接信息，然后直接进行下一步操作。</li><li>使用 KubeBlocks 部署数据库 - 使用官方提供的自动化数据库部署，数据库连接均为预设：</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>cd</span> deploy/databases/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>bash ./01-prepare.sh <span class=c1># 安装 KubeBlocks</span>
</span></span><span class=line><span class=cl>bash ./02-install-database.sh <span class=c1># 部署 PostgreSQL、Redis、Qdrant、Elasticsearch</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get pods -n default <span class=c1># 检查部署情况</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ../../
</span></span></code></pre></td></tr></table></div></div></div><p>等待所有数据库 Pod 处于 <code>running</code> 状态后即可进行下一步</p><ol><li>部署 ApeRAG 应用本身</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>helm install aperag ./deploy/aperag --namespace default --create-namespace <span class=c1># 部署 Ape 服务</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get pods -n default -l app.kubernetes.io/instance<span class=o>=</span>aperag <span class=c1># 检查服务状态</span>
</span></span></code></pre></td></tr></table></div></div></div><ol><li>配置选项</li></ol><ul><li>资源要求：默认情况下，包括 <a href=https://github.com/apecloud/doc-ray target=_blank rel=noopener>doc-ray 服务(官方提供的可用于独立部署的文档解析服务，但是暂不可用)</a> 需要至少 4 核 CPU，以及 8GB RAM，当然 Doc-ray 可以在 <code>values.yaml</code> 中配置<code>docray.enabled: false</code>禁用。</li><li>更多高级设置可以查看<code>values.yaml</code>已修改包括图像，资源，和入口的设置</li></ul><ol><li>访问部署</li></ol><p>在部署完成后即可通过端口转发以访问 ApeRAG</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl port-forward svc/aperag-fronted 3000:3000 -n default
</span></span><span class=line><span class=cl>kubectl port-forward svc/aperag-api 8000:8000 -n default
</span></span></code></pre></td></tr></table></div></div></div><h2 id=second---特性简析><a href=#second---特性简析 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:second---特性简析 class=headings>Second - 特性简析</a></h2><h3 id=文档解析><a href=#文档解析 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:文档解析 class=headings>文档解析</a></h3><p>目前其对于上传的文件大致内置了如下几种文档解析方式</p><ul><li>MarkItDownParser: 依靠微软的 <a href=https://github.com/microsoft/markitdown target=_blank rel=noopener>MarkitDown</a> 将文档转换为 Markdown 格式的纯文本文档然后交给其内置实现的 <code>parse_md</code> 模块去处理，支持<code>.txt</code>、<code>.md</code>、<code>.html</code>、<code>.ipynb</code>、<code>.pdf</code>、<code>.epub</code> 以及 Microsoft Office 文档（<code>.docx</code>、<code>.doc</code>、<code>.xlsx</code>、<code>.xls</code>、<code>.pptx</code>、<code>.ppt</code>）。</li><li>DocRayParser：是官方提供的另一个独立的微服务<a href=https://github.com/apecloud/doc-ray target=_blank rel=noopener>doc-ray</a>，用以提供复杂文档解析<code>.pdf</code>、<code>.docx</code>、<code>.doc</code>、<code>.pptx</code>、<code>.ppt</code>。，同时支持 GPU 加速功能，需要额外部署并对外提供 HTTP 接口给 ApeRAG 做文档解析。<del>但目前其无法运行在 K8s 中</del></li><li>AudioParser：对音频文件 mp3、wav、ogg 文件的支持，通过外部的 Whisper ASR Web 服务将音频转为文本，需要在 ApeRAG 中配置外部服务地址 <code>settings.WHISPER_HOST</code></li><li>ImageParser：从图像中提取文本（OCR 技术），支持<code>.jpg</code>、<code>.png</code>、<code>.bmp</code> 等格式。同样使用了外部服务 PaddleOCR，通过 <code>settings.PADDLEOCR_HOST</code> 配置开启</li><li>MinerUParser: 依靠外部 MinerUParser 服务对文档提供高精度的解析服务，需要配置 MinerU API，支持<code>.pdf</code>,<code>.doc</code>,<code>.docx</code>,<code>.ppt</code>,<code>.pptx</code>,<code>.png</code>,<code>.jpg</code>,<code>.jpeg</code></li></ul><blockquote><p>工作流程</p></blockquote><ol><li><p>文件上传后暂存在临时目录内，将文件路径传递给总的<code>DocParser</code></p></li><li><p><code>DocParser</code>根据配置选项以及文件类型选择合适的解析器，例如<code>MarkItDownParser</code>或者<code>DocRayParser</code></p></li><li><p>使用选定的解析器处理文件</p><ul><li>文件可能会被转换为 Markdown 格式，例如 <code>MarkItDownParser</code></li><li>也可能调用外部的服务进行解析，或者使用 OCR/ASR</li></ul></li><li><p>生成的中间文本交给 <code>parse_md.py</code> 解析成为 <code>Part</code> 列表（如果适用），此步骤将会将文档结构化为文本单元，例如段落、标题、代码块、并使用对应的解析器处理嵌入的图像</p></li><li><p>生成的各种类型的 <code>Part</code> 对象列表传递给后续的 <code>chunking.py</code> 模块中的 <code>rechunk</code> 函数</p></li><li><p><code>rechunk</code> 智能组合拆分这些部分，依据传入的 <code>chunk_size</code>、<code>chunk_overlap</code> 生成符合 token 大小最终文本块，准备好进行嵌入。同时元数据，包括标题层级和源位置将会与每个块关联。</p><ol><li>rechunk 首先会将传入的所有 <code>Part</code> 分组，按照同层级（类似 H1,H2 这样的分层）或者同级嵌套的合并到统一个组中</li><li>接下来针对上一步生成的 <code>Groups</code> 会判断哪些是纯标题组，并将连续的纯标题组合并，并保持层级关系（只合并同级别的标题组，例如同为 H2 的不会合并到 H3 中）</li><li>最后会尝试合并上一步中合并的标题组的 <code>Part</code> 们，即将同标题组的内容合并到单一组中返回新合并的组列表</li></ol></li><li><p>接下来进入正式的 Rechunk 环节</p><ol><li>首先利用栈数据结构处理层级关系，跟踪层级结构</li><li>计算当前处理的组的 Token 数量，与上一组最后一个 <code>Part</code> 的层级关系做对比判断是否是父子关系，是的话在满足二者相加小于限制的 <code>chunk_size</code> 的情况下将上一组内容合并到当前组中。</li><li>如果当前组无法被合并进上一组中，则直接将上一个 <code>Part</code> 直接放入结果列表中</li><li>接着继续处理当前组，遍历当前组所有 <code>Part</code>，计算每个 <code>Part</code> 的 Token 数量判断是否大于限制的 <code>chunk_size</code>,出现大于的情况的话则使用 <code>SimpleSemanticSplitter</code> 切分当前 <code>Part</code> 成多个不同的 <code>Part</code>，并于这些 <code>Part</code> 的元数据中标记这些切分出来的 <code>Part</code>：<code>metadata["splitted"] = True</code></li><li>针对上一步切分生成的 <code>Part</code> 进行一次 Rechunk：<ol><li>遍历 <code>Part</code> 们计算每个 <code>Part</code> 的 Token 数量进行累加，如果小于 <code>chunk_size</code> 则合并 <code>Part</code>；如果大于 <code>chunk_size</code> 限制则将现有 <code>Part</code> 存入最终结果。</li></ol></li></ol></li></ol><h3 id=多种索引类型><a href=#多种索引类型 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:多种索引类型 class=headings>多种索引类型</a></h3><p>ApeRAG 针对文档实现了多种类型的索引构建，包括传统向量检索，全文检索，GraphRAG(依托 LightRAG)实现，摘要检索，视觉检索。</p><p>其中向量检索和全文检索是必须开启的，即针对一份文档亦或者是知识库而言，这二者是必选的项目，其他三个 Graph、Summary 以及 Vision 都是可选的。</p><p><img src=image.png alt="alt text"></p><h4 id=向量索引-vector><a href=#向量索引-vector class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:向量索引-vector class=headings>向量索引 (Vector)</a></h4><p>ApeRAG 目前使用 <a href=https://github.com/qdrant/qdrant target=_blank rel=noopener>Qdrant</a> 作为其向量数据库，使用<code>collection</code>（知识库）创建时指定的<code>embedding model</code>，同时默认使用 <code>cl100k_base</code> 作为其 <code>tokenizer</code>.</p><p>对于所有的 <code>Part</code> 列表，选取其中具有 <code>content</code> 文本内容的部分，为这些 <code>Part</code> 的元数据添加 <code>indexer</code> 字段并附加上 <code>embedding</code> 内容。</p><h4 id=全文索引-full-text><a href=#全文索引-full-text class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:全文索引-full-text class=headings>全文索引 (Full-Text)</a></h4><p>全文索引依靠 <a href=https://github.com/elastic/elasticsearch target=_blank rel=noopener>Elasticsearch</a> 全文检索引擎实现。</p><p>对于所有传入的 <code>Part</code> 列表，选取其中具有 <code>content</code>的文本内容部分。使用 <code>rechunk</code> 函数重新组合生成待处理的 <code>chunked_parts</code>, 之后将这些 <code>chunked_parts</code> 依次配合代入的元数据交给 <code>Elasticsearch</code> 引擎去做索引。</p><h4 id=graph-索引-graphrag><a href=#graph-索引-graphrag class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:graph-索引-graphrag class=headings>Graph 索引 (GraphRAG)</a></h4><p>GraphRAG 功能 ApeRAG 依靠 <a href=https://lightrag.github.io/ target=_blank rel=noopener>LightRAG</a> 实现，并对其做了一系列的优化，包括让其支持生产级的并发处理，分布式任务队列（依靠 Celery/Prefect 实现）和无状态操作。</p><ol><li>在其异步创建索引的过程中，首先会检查需要索引的文档以及 <code>collection</code> 知识库在数据库中的状态，跳过标记删除的部分</li><li>之后读取上传文件的原始位置，并开启计划任务提交给任务队列。</li><li>当索引任务进入到执行状态后更新数据库中任务记录的状态。</li><li>首先会获取目前项目配置的 GraphRAG 所使用的存储配置，默认是 <code>PostgreSQL/PGVector</code>，同时也支持使用 Oracle 数据库、Neo4j 以及 NetworkX。等待存储初始化完成。</li><li>接下来使用 LightRAG 构建 LightRAG 实例</li><li>对于传入的 <code>content</code> 进行异步插入到 LightRAG 实例中待并等待所有处理操作完成。</li></ol><h4 id=摘要索引-summary-index><a href=#摘要索引-summary-index class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:摘要索引-summary-index class=headings>摘要索引 (Summary Index)</a></h4><p>摘要索引所使用数据库与向量索引一致，本质就是使用 LLM 对于传入文档纯文本内容 <code>content</code> 和分割好的 <code>doc_parts</code> 的内容进行总结，生成 Summary 并附加在元数据中，最后存储在向量数据库中.</p><p>Summary 时会根据传入的文本是或否是 chunk 亦或者直接就是完整的文档而选择不同的 prompt。</p><ul><li>Chunk 所使用的 Prompt：</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Summarize this text chunk concisely. Requirements:
</span></span><span class=line><span class=cl>1. Use the same language as the original text for the summary
</span></span><span class=line><span class=cl>2. Keep it within 1-2 sentences
</span></span><span class=line><span class=cl>3. Extract only the most important core information
</span></span><span class=line><span class=cl>4. Stay objective and accurate, do not add content not present in the original text
</span></span><span class=line><span class=cl>5. Output ONLY the summary content, no additional text, explanations, or formatting
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Text content:
</span></span><span class=line><span class=cl>{text}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Summary:
</span></span></code></pre></td></tr></table></div></div></div><ul><li>Document 所使用的 Prompt：</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Generate a concise summary of this document. Requirements:
</span></span><span class=line><span class=cl>1. Use the same language as the original text for the summary
</span></span><span class=line><span class=cl>2. Keep it within 2-3 sentences
</span></span><span class=line><span class=cl>3. Summarize the main topic and key insights of the document
</span></span><span class=line><span class=cl>4. Stay objective and accurate, do not add content not present in the original text
</span></span><span class=line><span class=cl>5. If it&#39;s a technical document, highlight the technical points
</span></span><span class=line><span class=cl>6. Output ONLY the summary content, no additional text, explanations, or formatting
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Document content:
</span></span><span class=line><span class=cl>{text}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Summary:
</span></span></code></pre></td></tr></table></div></div></div><ol><li>首先，对所有包含 <code>content</code> 的 <code>doc_part</code> 进行 Summary，如果这一步没能满足即没有 doc_part 则直接使用 content 进行 Summary</li><li>对于上一步初步 Summary 好生成的 Summary 结果进行 <code>reduce_summaries</code>：将上一步初步生成的 Summary 整合在一起之后重新交给 LLM 再做一次总结得到 <code>final_summary</code>，以下是总结 <code>final_summary</code> 所使用的 prompt:</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Combine these section summaries into a comprehensive final document summary. Requirements:
</span></span><span class=line><span class=cl>1. Use the same language as the original summaries for the final summary
</span></span><span class=line><span class=cl>2. Keep it within 3-4 sentences
</span></span><span class=line><span class=cl>3. Integrate the core content from all sections into a coherent overall summary
</span></span><span class=line><span class=cl>4. Highlight the main topic and most important insights of the document
</span></span><span class=line><span class=cl>5. Maintain logical clarity and avoid repetitive content
</span></span><span class=line><span class=cl>6. If technical content is involved, maintain accuracy of technical terminology
</span></span><span class=line><span class=cl>7. Output ONLY the final summary content, no additional text, explanations, or formatting
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Section summaries:
</span></span><span class=line><span class=cl>{combined_summaries}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Final summary:
</span></span></code></pre></td></tr></table></div></div></div><h4 id=视觉索引-vision-index><a href=#视觉索引-vision-index class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:视觉索引-vision-index class=headings>视觉索引 (Vision Index)</a></h4><p>视觉索引默认使用用户添加的多模态模型对 <code>collection</code> 知识库中的非文本文件进行多模态识别。同时多模态识别具备如下两种方案：</p><ol><li>纯粹的视觉方案，将媒体文件直接转换为向量并附加在元数据中存储向量数据库</li><li>使用多模态模型的 Vision-to-Text 功能，让大模型去描述媒体文件的内容生成文本，最后将文本向量化存入向量数据库中。以下是其默认使用的提供给大模型做视觉识别的 Prompt:</li></ol><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    Analyze the provided image and extract its content with high fidelity. Follow these instructions precisely and use Markdown for formatting your entire response. Do not include any introductory or conversational text.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1.  **Overall Summary:**
</span></span><span class=line><span class=cl>    *   Provide a brief, one-paragraph overview of the image&#39;s main subject, setting, and any depicted activities.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2.  **Detailed Text Extraction:**
</span></span><span class=line><span class=cl>    *   Extract all text from the image, preserving the original language. Do not translate.
</span></span><span class=line><span class=cl>    *   **Crucially, maintain the visual reading order.** For multi-column layouts, process the text column by column (e.g., left column top-to-bottom, then right column top-to-bottom).
</span></span><span class=line><span class=cl>    *   **Exclude headers and footers:** Do not extract repetitive content from the top (headers) or bottom (footers) of the page, such as page numbers, book titles, or chapter names.
</span></span><span class=line><span class=cl>    *   Replicate the original formatting using Markdown as much as possible (e.g., headings, lists, bold/italic text).
</span></span><span class=line><span class=cl>    *   For mathematical formulas or equations, represent them using LaTeX syntax (e.g., `$$...$$` for block equations, `$...$` for inline equations).
</span></span><span class=line><span class=cl>    *   For tables, reproduce them accurately using GitHub Flavored Markdown (GFM) table syntax.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>3.  **Chart/Graph Analysis:**
</span></span><span class=line><span class=cl>    *   If the image contains charts, graphs, or complex tables, identify their type (e.g., bar chart, line graph, pie chart).
</span></span><span class=line><span class=cl>    *   Explain the data presented, including axes, labels, and legends.
</span></span><span class=line><span class=cl>    *   Summarize the key insights, trends, or comparisons revealed by the data.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>4.  **Object and Scene Recognition:**
</span></span><span class=line><span class=cl>    *   List all significant objects, entities, and scene elements visible in the image.
</span></span></code></pre></td></tr></table></div></div></div><h3 id=混合检索><a href=#混合检索 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:混合检索 class=headings>混合检索</a></h3><p>ApeRAG 的检索流程其实可以近似理解为将现有集成的五种 RAG 引擎编织成一张有向图工作流，设定起点和终点，从起点开始进发到五种 RAG 进行检索召回，并一起进入到下一个节点做 Merge 合并，在合并完成之后再做一次 Rerank，并将最终结果交给 LLM 节点去做大模型回复。借由如上所述的实现方式，其未来期望规划（从代码中的痕迹来看）还将会支持这张图的自定义。其实现了一个图构建器，你可以使用 yaml 格式的文件去构建自定义的 workflow 工作流。</p><p>针对每一种检索方式，都需要有对应的 <code>Node</code> 实现，需要规定这个 <code>Node</code> 的输入和输出参数，以及节点内部的工作。同时这些输入输出会交给后续的节点作为输入，例如在 merge 的步骤中。</p><p>所有的 workflow 中的图节点，在没有依赖关系的情况下会被并行执行以优化效率，例如所有的 Search 节点。而当节点之间存在依赖关系时则会进行顺序执行的逻辑，例如 Merge 和 Rerank 两个节点二者是相互依赖的关系因此会顺序执行。</p><blockquote><p>PS: 以下所有的 <code>collection_ids</code> 虽然都是列表，理论上是复数个 collection 知识库的 id，但是实际项目中获取知识库详情时都是使用 <code>collection_ids[0]</code> 也就是这个列表其实只会使用第一个 id。</p></blockquote><h4 id=vector-search-向量检索><a href=#vector-search-向量检索 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:vector-search-向量检索 class=headings>Vector Search 向量检索</a></h4><ul><li>输入结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>VectorSearchInput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>top_k</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Number of top results to return&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>similarity_threshold</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Similarity threshold for vector search&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Collection IDs&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>chat_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Chat ID to filter chat documents&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>输出结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>VectorSearchOutput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li><p>工作流程</p><ol><li>首先根据传入的 <code>collection_ids</code> 从常规数据库中拉取数据集详情信息，并依据这些详情信息构建向量数据库实例，同时初始化对应的 embedding 模型。</li><li>使用 embedding 模型将用户输入转换为 vector 向量，并使用向量数据库实例去查询召回 <code>topK</code> 个结果。</li><li>对结果做一下遍历，标记这些结果的召回来源，即标记 <code>metadata.recall_type = "vector_search"</code></li></ol></li></ul><h4 id=fulltext-search-全文检索><a href=#fulltext-search-全文检索 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:fulltext-search-全文检索 class=headings>Fulltext Search 全文检索</a></h4><ul><li>输入结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>FulltextSearchInput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=o>...</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;User&#39;s question or query&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>top_k</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Number of top results to return&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Collection IDs&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>keywords</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Custom keywords to use for fulltext search&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>chat_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Chat ID to filter chat documents&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>输出结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>FulltextSearchOutput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li><p>工作流程</p><ol><li>根据 <code>collection_ids</code> 从常规数据库中获取知识库详情信息</li><li>使用 <code>settings.llm_keyword_extraction_provider</code> 等配置去使用大模型提取查询内容关键词，当然默认配置缺省使用 <code>IKKeywordExtractor</code>。</li><li>使用关键词去 elasticsearch 数据库进行全文检索，根据召回的结果内附带的 <code>_source</code> 参数去获取原始的 chunk 段落返回</li><li>给所有返回结果附加上召回类型 <code>metadata.recall_type = "fulltext_search"</code></li></ol></li></ul><h4 id=summary-search-摘要检索><a href=#summary-search-摘要检索 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:summary-search-摘要检索 class=headings>Summary Search 摘要检索</a></h4><ul><li>输入结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SummarySearchInput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>top_k</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Number of top results to return&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>similarity_threshold</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Similarity threshold for summary search&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Collection IDs&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>输出结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>SummarySearchOutput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li><p>工作流程</p><p>因为摘要检索本质其实还是一种向量检索，只是检索的内容是通过 LLM 大模型根据原文 Chunk 生成的摘要，因此这里的检索步骤其实和之前的向量检索大同小异</p><ol><li>根据 <code>collection_ids</code> 从传统数据库召回知识库详情信息。</li><li>依靠 collection 信息初始化好 embedding model 和向量数据库句柄。</li><li>将传入的查询文本使用对应的 embedding model 转换为查询向量。</li><li>使用句柄进行向量检索并对所有返回结果附加上召回类别 <code>metadata.recall_type = "summary_search"</code></li></ol></li></ul><h4 id=graphrag-检索><a href=#graphrag-检索 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:graphrag-检索 class=headings>GraphRAG 检索</a></h4><ul><li>输入结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>GraphSearchInput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>top_k</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Number of top results to return&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Collection IDs&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>输出结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>GraphSearchOutput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li><p>工作流程</p><ol><li>根据 <code>collection_ids</code> 从传统数据库获取知识库详情</li><li>对该知识库是否开启图检索做一次校验，如果没有开启则直接返回空列表</li><li>根据知识库 <code>collection</code> 的详情配置初始化 <code>LightRAG</code> 实例，这里的实例实际上启动的是一个 ApeRAG 二次封装过的 LightRAG 实例，这个实例的改进了 LightRAG 的检索使之支持并行，同时优化了 LightRAG 的存储使之可以支持 PG 等数据库。</li><li>使用 LightRAG 的 hybrid 进行混合检索召回 <code>topK</code> 个结果</li><li>将返回结果附加上召回类别 <code>metadata.recall_type = "graph_search"</code></li></ol></li></ul><h4 id=vision-search-视觉检索><a href=#vision-search-视觉检索 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:vision-search-视觉检索 class=headings>Vision Search 视觉检索</a></h4><ul><li>输入结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>VisionSearchInput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>top_k</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Number of top results to return&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>similarity_threshold</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Similarity threshold for vision search&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_ids</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Collection IDs&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>输出结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>VisionSearchOutput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li><p>工作流程</p><ol><li>根据 <code>collection_ids</code> 获取传统数据库存储的知识库详情</li><li>依据知识库配置初始化向量数据库句柄以及 embedding model</li><li>针对用户输入使用对应的 embedding model 向量化处理</li><li>将输入内容在向量数据库中做查询。到这里会发现其实这一步和向量检索几乎没有区别，所以作者为了防止这一步和向量检索重复，因此这里作者召回数量其实是 2 * topK 两倍的 topK 以确保召回了之前存储的视觉相关内容</li><li>对返回结果附加上召回类型 <code>metadata.recall_type = "vision_search"</code></li></ol></li></ul><h4 id=merge-节点><a href=#merge-节点 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:merge-节点 class=headings>Merge 节点</a></h4><ul><li>输入结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>MergeInput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>merge_strategy</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=s2>&#34;union&#34;</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;How to merge results&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>deduplicate</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Whether to deduplicate merged results&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>vector_search_docs</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Vector search docs&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>fulltext_search_docs</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Fulltext search docs&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>graph_search_docs</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Graph search docs&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>summary_search_docs</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Summary search docs&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>vision_search_docs</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Vision search docs&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>qa_search_docs</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>list</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Q&amp;A search docs&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>输出结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>MergeOutput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li><p>工作流程</p><ul><li>merge 并没有什么复杂的流程，目前只做了一个简单的使用 python 的 Set 集合结构依据召回内容的 text 文本对所有召回文档进行去重。</li></ul></li></ul><h4 id=rerank-节点><a href=#rerank-节点 class=anchor-link><svg viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a><a href=#contents:rerank-节点 class=headings>Rerank 节点</a></h4><ul><li>输入结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>RerankInput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>use_rerank_service</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Whether to use rerank service or fallback strategy&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Rerank model name&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>model_service_provider</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Model service provider&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>custom_llm_provider</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>default</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>description</span><span class=o>=</span><span class=s2>&#34;Custom LLM provider (e.g., &#39;jina_ai&#39;, &#39;openai&#39;)&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li>输出结构</li></ul><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>RerankOutput</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>docs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>DocumentWithScore</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div></div><ul><li><p>工作流程</p><ol><li>根据传入参数 <code>use_rerank_service</code> 决定是否使用三方的 rerank 服务（例如 openai 以及其他大模型供应商提供的 rerank 服务接口），如果不使用则使用默认逻辑：GraphRAG 结果放在前面，剩余的各种向量检索结果按照 Score 得分从高到低排列。</li><li>如果 rerank 配置的参数不合法则也会使用默认策略</li><li>根据配置的 rerank 服务执行 rerank</li></ol></li></ul></div><ul class=post-copyright><li class="copyright-item author"><span class=copyright-item-text>作者</span>：<a href=https://yuukisama.cc/ class="p-author h-card" target=_blank rel=noopener>Yuuki</a></li><li class="copyright-item link"><span class=copyright-item-text>链接</span>：<a href=/code/aperag/ target=_blank rel=noopener>https://yuukisama.cc/code/aperag/</a></li><li class="copyright-item license"><span class=copyright-item-text>许可</span>：<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a></li></ul></article><div class=updated-badge-container><span title="Updated @ 2025-11-10 17:45:53 +0800" style=cursor:help><svg width="130" height="20" class="updated-badge"><linearGradient id="b" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><clipPath id="a"><rect width="130" height="20" rx="3" fill="#fff"/></clipPath><g clip-path="url(#a)"><path class="updated-badge-left" d="M0 0h55v20H0z"/><path class="updated-badge-right" d="M55 0h75v20H55z"/><path fill="url(#b)" d="M0 0h130v20H0z"/></g><g fill="#fff" text-anchor="middle" font-size="110"><text x="285" y="150" fill="#010101" fill-opacity=".3" textLength="450" transform="scale(.1)">updated</text><text x="285" y="140" textLength="450" transform="scale(.1)">updated</text><text x="915" y="150" fill="#010101" fill-opacity=".3" textLength="650" transform="scale(.1)">2025-11-10</text><text x="915" y="140" textLength="650" transform="scale(.1)">2025-11-10</text></g></svg></span></div><div class=post-share><div class=share-items><div class="share-item facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=https://yuukisama.cc/code/aperag/&amp;hashtag=%23AI" title=分享到「Facebook」 target=_blank rel=noopener><svg viewBox="0 0 512 512" class="icon facebook-icon"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></a></div><div class="share-item mastodon"><a href="/fedishare.html#title=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90&amp;description=Zero%20-%20ApeRAG%20%e7%ae%80%e4%bb%8b%20ApeRAG%20%e4%b8%80%e4%b8%aa%e5%8f%b7%e7%a7%b0%e7%94%9f%e4%ba%a7%e5%b0%b1%e7%bb%aa%e7%9a%84%20GraphRAG%20%e5%a4%9a%e6%a8%a1%e6%80%81%20RAG%20%e5%bc%95%e6%93%8e%e3%80%82%e4%bb%a5%e4%b8%8b%e6%98%af%e5%85%b6%e5%ae%98%e7%bd%91%20https://rag.apecloud.com/%0a%e7%9b%ae%e5%89%8d%e5%ae%98%e6%96%b9%e5%8f%91%e5%b8%83%e4%ba%86%20ApeRAG%20v0.5.0-alpha.14%20%e7%89%88%e6%9c%ac%ef%bc%8c%e5%85%b6%e7%bb%93%e5%90%88%e4%ba%86%e4%bc%a0%e7%bb%9f%e5%90%91%e9%87%8f%e5%bc%95%e6%93%8e%ef%bc%8c%e5%85%a8%e6%96%87%e7%b4%a2%e5%bc%95%ef%bc%8cGraphRAG%ef%bc%8c%e8%a7%86%e8%a7%89%e7%b4%a2%e5%bc%95%ef%bc%8c%e6%91%98%e8%a6%81%e7%b4%a2%e5%bc%95%e7%ad%89%e5%a4%9a%e4%b8%aa%e7%bb%b4%e5%ba%a6%e5%85%a8%e6%96%b9%e9%9d%a2%e7%9a%84%20RAG%20%e6%b7%b7%e5%90%88%e6%a3%80%e7%b4%a2%e8%83%bd%e5%8a%9b%ef%bc%8c%e4%bd%bf%e7%94%a8%20MinerU%20%e9%9b%86%e6%88%90%e4%bd%9c%e4%b8%ba%e5%85%b6%e5%a2%9e%e5%bc%ba%e5%9e%8b%e7%9a%84%e6%96%87%e6%a1%a3%e5%a4%84%e7%90%86%e3%80%82%e5%9c%a8%e9%83%a8%e7%bd%b2%e6%96%b9%e9%9d%a2%ef%bc%8c%e5%ae%98%e6%96%b9%e7%9b%b4%e6%8e%a5%e6%8f%90%e4%be%9b%e4%ba%86%e7%94%9f%e4%ba%a7%e7%ba%a7%e9%83%a8%e7%bd%b2%e7%9a%84%e8%83%bd%e5%8a%9b%ef%bc%9a%e6%9c%80%e7%ae%80%e5%8f%af%e9%80%9a%e8%bf%87%20docker%20%e5%ae%8c%e6%88%90%e5%9f%ba%e7%a1%80%e9%83%a8%e7%bd%b2%ef%bc%8c%e5%90%8c%e6%97%b6%e6%8f%90%e4%be%9b%e4%ba%86%20k8s%20%e9%83%a8%e7%bd%b2%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%8c%87%e5%af%bc%e3%80%82%e5%90%8c%e6%97%b6%e9%9b%86%e6%88%90%e4%ba%86%20MCP%20%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%8f%90%e4%be%9b%e4%b8%89%e6%96%b9%20AI%20%e5%8a%a9%e6%89%8b%e5%92%8c%e5%b7%a5%e5%85%b7%e6%97%a0%e7%bc%9d%e9%9b%86%e6%88%90%e8%ae%bf%e9%97%ae%e7%9f%a5%e8%af%86%e5%ba%93%e7%9a%84%e8%83%bd%e5%8a%9b%e3%80%82%0a&amp;url=https://yuukisama.cc/code/aperag/" title=分享到「Mastodon」 target=_blank rel=noopener><svg viewBox="0 0 448 512" class="icon mastodon-icon"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></a></div><div class="share-item fediverse"><a href="/fedishare.html#title=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90&amp;description=Zero%20-%20ApeRAG%20%e7%ae%80%e4%bb%8b%20ApeRAG%20%e4%b8%80%e4%b8%aa%e5%8f%b7%e7%a7%b0%e7%94%9f%e4%ba%a7%e5%b0%b1%e7%bb%aa%e7%9a%84%20GraphRAG%20%e5%a4%9a%e6%a8%a1%e6%80%81%20RAG%20%e5%bc%95%e6%93%8e%e3%80%82%e4%bb%a5%e4%b8%8b%e6%98%af%e5%85%b6%e5%ae%98%e7%bd%91%20https://rag.apecloud.com/%0a%e7%9b%ae%e5%89%8d%e5%ae%98%e6%96%b9%e5%8f%91%e5%b8%83%e4%ba%86%20ApeRAG%20v0.5.0-alpha.14%20%e7%89%88%e6%9c%ac%ef%bc%8c%e5%85%b6%e7%bb%93%e5%90%88%e4%ba%86%e4%bc%a0%e7%bb%9f%e5%90%91%e9%87%8f%e5%bc%95%e6%93%8e%ef%bc%8c%e5%85%a8%e6%96%87%e7%b4%a2%e5%bc%95%ef%bc%8cGraphRAG%ef%bc%8c%e8%a7%86%e8%a7%89%e7%b4%a2%e5%bc%95%ef%bc%8c%e6%91%98%e8%a6%81%e7%b4%a2%e5%bc%95%e7%ad%89%e5%a4%9a%e4%b8%aa%e7%bb%b4%e5%ba%a6%e5%85%a8%e6%96%b9%e9%9d%a2%e7%9a%84%20RAG%20%e6%b7%b7%e5%90%88%e6%a3%80%e7%b4%a2%e8%83%bd%e5%8a%9b%ef%bc%8c%e4%bd%bf%e7%94%a8%20MinerU%20%e9%9b%86%e6%88%90%e4%bd%9c%e4%b8%ba%e5%85%b6%e5%a2%9e%e5%bc%ba%e5%9e%8b%e7%9a%84%e6%96%87%e6%a1%a3%e5%a4%84%e7%90%86%e3%80%82%e5%9c%a8%e9%83%a8%e7%bd%b2%e6%96%b9%e9%9d%a2%ef%bc%8c%e5%ae%98%e6%96%b9%e7%9b%b4%e6%8e%a5%e6%8f%90%e4%be%9b%e4%ba%86%e7%94%9f%e4%ba%a7%e7%ba%a7%e9%83%a8%e7%bd%b2%e7%9a%84%e8%83%bd%e5%8a%9b%ef%bc%9a%e6%9c%80%e7%ae%80%e5%8f%af%e9%80%9a%e8%bf%87%20docker%20%e5%ae%8c%e6%88%90%e5%9f%ba%e7%a1%80%e9%83%a8%e7%bd%b2%ef%bc%8c%e5%90%8c%e6%97%b6%e6%8f%90%e4%be%9b%e4%ba%86%20k8s%20%e9%83%a8%e7%bd%b2%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%8c%87%e5%af%bc%e3%80%82%e5%90%8c%e6%97%b6%e9%9b%86%e6%88%90%e4%ba%86%20MCP%20%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%8f%90%e4%be%9b%e4%b8%89%e6%96%b9%20AI%20%e5%8a%a9%e6%89%8b%e5%92%8c%e5%b7%a5%e5%85%b7%e6%97%a0%e7%bc%9d%e9%9b%86%e6%88%90%e8%ae%bf%e9%97%ae%e7%9f%a5%e8%af%86%e5%ba%93%e7%9a%84%e8%83%bd%e5%8a%9b%e3%80%82%0a&amp;url=https://yuukisama.cc/code/aperag/" title=分享到「Fediverse」 target=_blank rel=noopener><svg viewBox="64 163 873 873" class="icon fediverse-icon"><defs><linearGradient id="fediverse-gradient"><stop offset="0" stop-color="#ff0101"/><stop offset="10%" stop-color="#9501ff"/><stop offset="50%" stop-color="#ffca01"/><stop offset="75%" stop-color="#01a3ff"/><stop offset="100%" stop-color="#65ff01"/></linearGradient></defs><path d="M539 176q-32 0-55 22t-25 55 20.5 58 56 27 58.5-20.5 27-56-20.5-59T544 176h-5zm-87 95-232 118q20 20 25 48l231-118q-19-20-24-48zm167 27q-13 25-38 38l183 184q13-25 39-38zM477 320 342 585l40 40 143-280q-28-5-48-25zm104 16q-22 11-46 10l-8-1 21 132 56 9zM155 370q-32 0-55 22.5t-25 55 20.5 58 56.5 27 59-21 26.5-56-21-58.5-55.5-27h-6zm90 68q1 9 1 18-1 19-10 35l132 21 26-50zm225 36-26 51 311 49q-1-8-1-17 1-19 10-36zm372 6q-32 1-55 23t-24.5 55 21 58 56 27 58.5-20.5 27-56.5-20.5-59-56.5-27h-6zM236 493q-13 25-39 38l210 210 51-25zm-40 38q-21 11-44 10l-9-1 40 256q21-10 45-9l8 1zm364 22 48 311q21-10 44-9l10 1-46-294zm195 23-118 60 8 56 135-68q-20-20-25-48zm26 49-119 231q28 5 48 25l119-231q-28-5-48-25zM306 654l-68 134q28 5 48 25l60-119zm262 17-281 143q19 20 24 48l265-135zM513 771l-51 25 106 107q13-25 39-38zM222 795q-32 0-55.5 22.5t-25 55 21 57.5 56 27 58.5-20.5 27-56-20.5-58.5-56.5-27h-5zm89 68q2 9 1 18-1 19-9 35l256 41q-1-9-1-18 1-18 10-35zm335 0q-32 0-55 22.5t-24.5 55 20.5 58 56 27 59-21 27-56-20.5-58.5-56.5-27h-6z"/></svg></a></div><div class="share-item twitter"><a href="https://twitter.com/share?url=https://yuukisama.cc/code/aperag/&amp;text=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90&amp;hashtags=AI,LLM,&amp;via=yukiricc" title=分享到「Twitter」 target=_blank rel=noopener><svg viewBox="0 0 512 512" class="icon twitter-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a></div><div class="share-item linkedin"><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://yuukisama.cc/code/aperag/&amp;title=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90&amp;summary=Zero%20-%20ApeRAG%20%e7%ae%80%e4%bb%8b%20ApeRAG%20%e4%b8%80%e4%b8%aa%e5%8f%b7%e7%a7%b0%e7%94%9f%e4%ba%a7%e5%b0%b1%e7%bb%aa%e7%9a%84%20GraphRAG%20%e5%a4%9a%e6%a8%a1%e6%80%81%20RAG%20%e5%bc%95%e6%93%8e%e3%80%82%e4%bb%a5%e4%b8%8b%e6%98%af%e5%85%b6%e5%ae%98%e7%bd%91%20https://rag.apecloud.com/%0a%e7%9b%ae%e5%89%8d%e5%ae%98%e6%96%b9%e5%8f%91%e5%b8%83%e4%ba%86%20ApeRAG%20v0.5.0-alpha.14%20%e7%89%88%e6%9c%ac%ef%bc%8c%e5%85%b6%e7%bb%93%e5%90%88%e4%ba%86%e4%bc%a0%e7%bb%9f%e5%90%91%e9%87%8f%e5%bc%95%e6%93%8e%ef%bc%8c%e5%85%a8%e6%96%87%e7%b4%a2%e5%bc%95%ef%bc%8cGraphRAG%ef%bc%8c%e8%a7%86%e8%a7%89%e7%b4%a2%e5%bc%95%ef%bc%8c%e6%91%98%e8%a6%81%e7%b4%a2%e5%bc%95%e7%ad%89%e5%a4%9a%e4%b8%aa%e7%bb%b4%e5%ba%a6%e5%85%a8%e6%96%b9%e9%9d%a2%e7%9a%84%20RAG%20%e6%b7%b7%e5%90%88%e6%a3%80%e7%b4%a2%e8%83%bd%e5%8a%9b%ef%bc%8c%e4%bd%bf%e7%94%a8%20MinerU%20%e9%9b%86%e6%88%90%e4%bd%9c%e4%b8%ba%e5%85%b6%e5%a2%9e%e5%bc%ba%e5%9e%8b%e7%9a%84%e6%96%87%e6%a1%a3%e5%a4%84%e7%90%86%e3%80%82%e5%9c%a8%e9%83%a8%e7%bd%b2%e6%96%b9%e9%9d%a2%ef%bc%8c%e5%ae%98%e6%96%b9%e7%9b%b4%e6%8e%a5%e6%8f%90%e4%be%9b%e4%ba%86%e7%94%9f%e4%ba%a7%e7%ba%a7%e9%83%a8%e7%bd%b2%e7%9a%84%e8%83%bd%e5%8a%9b%ef%bc%9a%e6%9c%80%e7%ae%80%e5%8f%af%e9%80%9a%e8%bf%87%20docker%20%e5%ae%8c%e6%88%90%e5%9f%ba%e7%a1%80%e9%83%a8%e7%bd%b2%ef%bc%8c%e5%90%8c%e6%97%b6%e6%8f%90%e4%be%9b%e4%ba%86%20k8s%20%e9%83%a8%e7%bd%b2%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%8c%87%e5%af%bc%e3%80%82%e5%90%8c%e6%97%b6%e9%9b%86%e6%88%90%e4%ba%86%20MCP%20%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%8f%90%e4%be%9b%e4%b8%89%e6%96%b9%20AI%20%e5%8a%a9%e6%89%8b%e5%92%8c%e5%b7%a5%e5%85%b7%e6%97%a0%e7%bc%9d%e9%9b%86%e6%88%90%e8%ae%bf%e9%97%ae%e7%9f%a5%e8%af%86%e5%ba%93%e7%9a%84%e8%83%bd%e5%8a%9b%e3%80%82%0a&amp;source=Broken%20Memories" title=分享到「LinkedIn」 target=_blank rel=noopener><svg viewBox="0 0 448 512" class="icon linkedin-icon"><path d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></a></div><div class="share-item telegram"><a href="https://t.me/share/url?url=https://yuukisama.cc/code/aperag/&amp;text=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90" title=分享到「Telegram」 target=_blank rel=noopener><svg viewBox="0 0 496 512" class="icon telegram-icon"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg></a></div><div class="share-item qq"><a href="https://connect.qq.com/widget/shareqq/index.html?url=https://yuukisama.cc/code/aperag/&amp;title=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90&amp;summary=Zero%20-%20ApeRAG%20%e7%ae%80%e4%bb%8b%20ApeRAG%20%e4%b8%80%e4%b8%aa%e5%8f%b7%e7%a7%b0%e7%94%9f%e4%ba%a7%e5%b0%b1%e7%bb%aa%e7%9a%84%20GraphRAG%20%e5%a4%9a%e6%a8%a1%e6%80%81%20RAG%20%e5%bc%95%e6%93%8e%e3%80%82%e4%bb%a5%e4%b8%8b%e6%98%af%e5%85%b6%e5%ae%98%e7%bd%91%20https://rag.apecloud.com/%0a%e7%9b%ae%e5%89%8d%e5%ae%98%e6%96%b9%e5%8f%91%e5%b8%83%e4%ba%86%20ApeRAG%20v0.5.0-alpha.14%20%e7%89%88%e6%9c%ac%ef%bc%8c%e5%85%b6%e7%bb%93%e5%90%88%e4%ba%86%e4%bc%a0%e7%bb%9f%e5%90%91%e9%87%8f%e5%bc%95%e6%93%8e%ef%bc%8c%e5%85%a8%e6%96%87%e7%b4%a2%e5%bc%95%ef%bc%8cGraphRAG%ef%bc%8c%e8%a7%86%e8%a7%89%e7%b4%a2%e5%bc%95%ef%bc%8c%e6%91%98%e8%a6%81%e7%b4%a2%e5%bc%95%e7%ad%89%e5%a4%9a%e4%b8%aa%e7%bb%b4%e5%ba%a6%e5%85%a8%e6%96%b9%e9%9d%a2%e7%9a%84%20RAG%20%e6%b7%b7%e5%90%88%e6%a3%80%e7%b4%a2%e8%83%bd%e5%8a%9b%ef%bc%8c%e4%bd%bf%e7%94%a8%20MinerU%20%e9%9b%86%e6%88%90%e4%bd%9c%e4%b8%ba%e5%85%b6%e5%a2%9e%e5%bc%ba%e5%9e%8b%e7%9a%84%e6%96%87%e6%a1%a3%e5%a4%84%e7%90%86%e3%80%82%e5%9c%a8%e9%83%a8%e7%bd%b2%e6%96%b9%e9%9d%a2%ef%bc%8c%e5%ae%98%e6%96%b9%e7%9b%b4%e6%8e%a5%e6%8f%90%e4%be%9b%e4%ba%86%e7%94%9f%e4%ba%a7%e7%ba%a7%e9%83%a8%e7%bd%b2%e7%9a%84%e8%83%bd%e5%8a%9b%ef%bc%9a%e6%9c%80%e7%ae%80%e5%8f%af%e9%80%9a%e8%bf%87%20docker%20%e5%ae%8c%e6%88%90%e5%9f%ba%e7%a1%80%e9%83%a8%e7%bd%b2%ef%bc%8c%e5%90%8c%e6%97%b6%e6%8f%90%e4%be%9b%e4%ba%86%20k8s%20%e9%83%a8%e7%bd%b2%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%8c%87%e5%af%bc%e3%80%82%e5%90%8c%e6%97%b6%e9%9b%86%e6%88%90%e4%ba%86%20MCP%20%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%8f%90%e4%be%9b%e4%b8%89%e6%96%b9%20AI%20%e5%8a%a9%e6%89%8b%e5%92%8c%e5%b7%a5%e5%85%b7%e6%97%a0%e7%bc%9d%e9%9b%86%e6%88%90%e8%ae%bf%e9%97%ae%e7%9f%a5%e8%af%86%e5%ba%93%e7%9a%84%e8%83%bd%e5%8a%9b%e3%80%82%0a&amp;pics=https://yuukisama.cc/image.png&amp;site=Broken%20Memories" title=分享到「QQ」 target=_blank rel=noopener><svg viewBox="0 0 448 512" class="icon qq-icon"><path d="M433.754 420.445c-11.526 1.393-44.86-52.741-44.86-52.741.0 31.345-16.136 72.247-51.051 101.786 16.842 5.192 54.843 19.167 45.803 34.421-7.316 12.343-125.51 7.881-159.632 4.037-34.122 3.844-152.316 8.306-159.632-4.037-9.045-15.25 28.918-29.214 45.783-34.415-34.92-29.539-51.059-70.445-51.059-101.792.0.0-33.334 54.134-44.859 52.741-5.37-.65-12.424-29.644 9.347-99.704 10.261-33.024 21.995-60.478 40.144-105.779C60.683 98.063 108.982.006 224 0c113.737.006 163.156 96.133 160.264 214.963 18.118 45.223 29.912 72.85 40.144 105.778 21.768 70.06 14.716 99.053 9.346 99.704z"/></svg></a></div><div class="share-item qzone"><a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://yuukisama.cc/code/aperag/&amp;title=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90&amp;summary=Zero%20-%20ApeRAG%20%e7%ae%80%e4%bb%8b%20ApeRAG%20%e4%b8%80%e4%b8%aa%e5%8f%b7%e7%a7%b0%e7%94%9f%e4%ba%a7%e5%b0%b1%e7%bb%aa%e7%9a%84%20GraphRAG%20%e5%a4%9a%e6%a8%a1%e6%80%81%20RAG%20%e5%bc%95%e6%93%8e%e3%80%82%e4%bb%a5%e4%b8%8b%e6%98%af%e5%85%b6%e5%ae%98%e7%bd%91%20https://rag.apecloud.com/%0a%e7%9b%ae%e5%89%8d%e5%ae%98%e6%96%b9%e5%8f%91%e5%b8%83%e4%ba%86%20ApeRAG%20v0.5.0-alpha.14%20%e7%89%88%e6%9c%ac%ef%bc%8c%e5%85%b6%e7%bb%93%e5%90%88%e4%ba%86%e4%bc%a0%e7%bb%9f%e5%90%91%e9%87%8f%e5%bc%95%e6%93%8e%ef%bc%8c%e5%85%a8%e6%96%87%e7%b4%a2%e5%bc%95%ef%bc%8cGraphRAG%ef%bc%8c%e8%a7%86%e8%a7%89%e7%b4%a2%e5%bc%95%ef%bc%8c%e6%91%98%e8%a6%81%e7%b4%a2%e5%bc%95%e7%ad%89%e5%a4%9a%e4%b8%aa%e7%bb%b4%e5%ba%a6%e5%85%a8%e6%96%b9%e9%9d%a2%e7%9a%84%20RAG%20%e6%b7%b7%e5%90%88%e6%a3%80%e7%b4%a2%e8%83%bd%e5%8a%9b%ef%bc%8c%e4%bd%bf%e7%94%a8%20MinerU%20%e9%9b%86%e6%88%90%e4%bd%9c%e4%b8%ba%e5%85%b6%e5%a2%9e%e5%bc%ba%e5%9e%8b%e7%9a%84%e6%96%87%e6%a1%a3%e5%a4%84%e7%90%86%e3%80%82%e5%9c%a8%e9%83%a8%e7%bd%b2%e6%96%b9%e9%9d%a2%ef%bc%8c%e5%ae%98%e6%96%b9%e7%9b%b4%e6%8e%a5%e6%8f%90%e4%be%9b%e4%ba%86%e7%94%9f%e4%ba%a7%e7%ba%a7%e9%83%a8%e7%bd%b2%e7%9a%84%e8%83%bd%e5%8a%9b%ef%bc%9a%e6%9c%80%e7%ae%80%e5%8f%af%e9%80%9a%e8%bf%87%20docker%20%e5%ae%8c%e6%88%90%e5%9f%ba%e7%a1%80%e9%83%a8%e7%bd%b2%ef%bc%8c%e5%90%8c%e6%97%b6%e6%8f%90%e4%be%9b%e4%ba%86%20k8s%20%e9%83%a8%e7%bd%b2%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%8c%87%e5%af%bc%e3%80%82%e5%90%8c%e6%97%b6%e9%9b%86%e6%88%90%e4%ba%86%20MCP%20%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%8f%90%e4%be%9b%e4%b8%89%e6%96%b9%20AI%20%e5%8a%a9%e6%89%8b%e5%92%8c%e5%b7%a5%e5%85%b7%e6%97%a0%e7%bc%9d%e9%9b%86%e6%88%90%e8%ae%bf%e9%97%ae%e7%9f%a5%e8%af%86%e5%ba%93%e7%9a%84%e8%83%bd%e5%8a%9b%e3%80%82%0a&amp;pics=https://yuukisama.cc/image.png&amp;site=Broken%20Memories" title="分享到「QQ 空间」" target=_blank rel=noopener><svg viewBox="0 0 24 24" class="icon qzone-icon"><path d="M23.985 9.202c-.032-.099-.127-.223-.334-.258-.207-.036-7.351-1.406-7.351-1.406s-.105-.022-.198-.07c-.092-.047-.127-.167-.127-.167S12.447.956 12.349.77C12.25.583 12.104.532 12 .532s-.251.051-.349.238c-.098.186-3.626 6.531-3.626 6.531s-.035.12-.128.167c-.092.047-.197.07-.197.07S.556 8.908.348 8.943c-.208.036-.302.16-.333.258a.477.477.0 00.125.449l5.362 5.49s.072.08.119.172c.016.104.005.21.005.21s-1.189 7.242-1.22 7.45.075.369.159.43c.083.062.233.106.421.013.189-.093 6.812-3.261 6.812-3.261s.098-.044.201-.061.201.061.201.061 6.623 3.168 6.812 3.261c.188.094.338.049.421-.013a.463.463.0 00.159-.43c-.021-.14-.93-5.677-.93-5.677.876-.54 1.425-1.039 1.849-1.747-2.594.969-6.006 1.717-9.415 1.866-.915.041-2.41.097-3.473-.015-.678-.071-1.17-.144-1.243-.438-.053-.215.054-.46.545-.831a2640.5 2640.5.0 012.861-2.155c1.285-.968 3.559-2.47 3.559-2.731.0-.285-2.144-.781-4.037-.781-1.945.0-2.275.132-2.811.168-.488.034-.769.005-.804-.138-.06-.248.183-.389.588-.568.709-.314 1.86-.594 1.984-.626.194-.052 3.082-.805 5.618-.535 1.318.14 3.244.668 3.244 1.276.0.342-1.721 1.494-3.225 2.597-1.149.843-2.217 1.561-2.217 1.688.0.342 3.533 1.241 6.689 1.01l.003-.022c.048-.092.119-.172.119-.172l5.362-5.49a.477.477.0 00.127-.449z"/></svg></a></div><div class="share-item pocket"><a href="https://getpocket.com/edit.php?url=https://yuukisama.cc/code/aperag/" title=分享到「Pocket」 target=_blank rel=noopener><svg viewBox="0 0 448 512" class="icon pocket-icon"><path d="M407.6 64h-367C18.5 64 0 82.5.0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4.0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9.0 30.7 13.8 30.7 30.7.0 17.8-2.9 15.7-114.8 123.2z"/></svg></a></div><div class="share-item hackernews"><a href="https://news.ycombinator.com/submitlink?u=https://yuukisama.cc/code/aperag/&amp;t=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90" title="分享到Hacker News" target=_blank rel=noopener><svg viewBox="0 0 448 512" class="icon hackernews-icon"><path d="M0 32v448h448V32H0zm21.2 197.2H21c.1-.1.2-.3.3-.4.0.1.0.3-.1.4zm218 53.9V384h-31.4V281.3L128 128h37.3c52.5 98.3 49.2 101.2 59.3 125.6 12.3-27 5.8-24.4 60.6-125.6H320l-80.8 155.1z"/></svg></a></div><div class="share-item qrcode"><div class=qrcode-container title=通过「二维码」><svg viewBox="0 0 448 512" class="icon qrcode-icon"><path d="M0 224h192V32H0v192zM64 96h64v64H64V96zm192-64v192h192V32H256zm128 128h-64V96h64v64zM0 480h192V288H0v192zm64-128h64v64H64v-64zm352-64h32v128h-96v-32h-32v96h-64V288h96v32h64v-32zm0 160h32v32h-32v-32zm-64 0h32v32h-32v-32z"/></svg><div id=qrcode-img></div></div><script src=https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js></script><script>const typeNumber=0,errorCorrectionLevel="L",qr=qrcode(typeNumber,errorCorrectionLevel);qr.addData("https://yuukisama.cc/code/aperag/"),qr.make(),document.getElementById("qrcode-img").innerHTML=qr.createImgTag()</script></div><div class="share-item email"><a href="mailto:?subject=ApeRAG%e6%9e%b6%e6%9e%84%e5%88%86%e6%9e%90&amp;body=Zero%20-%20ApeRAG%20%e7%ae%80%e4%bb%8b%20ApeRAG%20%e4%b8%80%e4%b8%aa%e5%8f%b7%e7%a7%b0%e7%94%9f%e4%ba%a7%e5%b0%b1%e7%bb%aa%e7%9a%84%20GraphRAG%20%e5%a4%9a%e6%a8%a1%e6%80%81%20RAG%20%e5%bc%95%e6%93%8e%e3%80%82%e4%bb%a5%e4%b8%8b%e6%98%af%e5%85%b6%e5%ae%98%e7%bd%91%20https://rag.apecloud.com/%0a%e7%9b%ae%e5%89%8d%e5%ae%98%e6%96%b9%e5%8f%91%e5%b8%83%e4%ba%86%20ApeRAG%20v0.5.0-alpha.14%20%e7%89%88%e6%9c%ac%ef%bc%8c%e5%85%b6%e7%bb%93%e5%90%88%e4%ba%86%e4%bc%a0%e7%bb%9f%e5%90%91%e9%87%8f%e5%bc%95%e6%93%8e%ef%bc%8c%e5%85%a8%e6%96%87%e7%b4%a2%e5%bc%95%ef%bc%8cGraphRAG%ef%bc%8c%e8%a7%86%e8%a7%89%e7%b4%a2%e5%bc%95%ef%bc%8c%e6%91%98%e8%a6%81%e7%b4%a2%e5%bc%95%e7%ad%89%e5%a4%9a%e4%b8%aa%e7%bb%b4%e5%ba%a6%e5%85%a8%e6%96%b9%e9%9d%a2%e7%9a%84%20RAG%20%e6%b7%b7%e5%90%88%e6%a3%80%e7%b4%a2%e8%83%bd%e5%8a%9b%ef%bc%8c%e4%bd%bf%e7%94%a8%20MinerU%20%e9%9b%86%e6%88%90%e4%bd%9c%e4%b8%ba%e5%85%b6%e5%a2%9e%e5%bc%ba%e5%9e%8b%e7%9a%84%e6%96%87%e6%a1%a3%e5%a4%84%e7%90%86%e3%80%82%e5%9c%a8%e9%83%a8%e7%bd%b2%e6%96%b9%e9%9d%a2%ef%bc%8c%e5%ae%98%e6%96%b9%e7%9b%b4%e6%8e%a5%e6%8f%90%e4%be%9b%e4%ba%86%e7%94%9f%e4%ba%a7%e7%ba%a7%e9%83%a8%e7%bd%b2%e7%9a%84%e8%83%bd%e5%8a%9b%ef%bc%9a%e6%9c%80%e7%ae%80%e5%8f%af%e9%80%9a%e8%bf%87%20docker%20%e5%ae%8c%e6%88%90%e5%9f%ba%e7%a1%80%e9%83%a8%e7%bd%b2%ef%bc%8c%e5%90%8c%e6%97%b6%e6%8f%90%e4%be%9b%e4%ba%86%20k8s%20%e9%83%a8%e7%bd%b2%e7%9a%84%e5%ae%9e%e8%b7%b5%e6%8c%87%e5%af%bc%e3%80%82%e5%90%8c%e6%97%b6%e9%9b%86%e6%88%90%e4%ba%86%20MCP%20%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%8f%90%e4%be%9b%e4%b8%89%e6%96%b9%20AI%20%e5%8a%a9%e6%89%8b%e5%92%8c%e5%b7%a5%e5%85%b7%e6%97%a0%e7%bc%9d%e9%9b%86%e6%88%90%e8%ae%bf%e9%97%ae%e7%9f%a5%e8%af%86%e5%ba%93%e7%9a%84%e8%83%bd%e5%8a%9b%e3%80%82%0a%0Ahttps://yuukisama.cc/code/aperag/" title=通过「电子邮件」 target=_blank rel=noopener><svg viewBox="0 0 512 512" class="icon email-icon"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg></a></div></div></div><div class=related-posts><h2 class=related-title>相关文章：<svg viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6.0-12-5.4-12-12v-92h-92c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6.0 12 5.4 12 12v92h92c6.6.0 12 5.4 12 12v56z"/></svg></h2><ul class=related-list><li class=related-item><a href=/code/plurai-ai-intellagent/ class=related-link>plurai-ai/intellagent 调研</a></li><li class=related-item><a href=/code/milvus%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB/ class=related-link>Milvus数据迁移</a></li><li class=related-item><a href=/code/k8s%E9%83%A8%E7%BD%B2n8n/ class=related-link>K8s部署n8n</a></li><li class=related-item><a href=/code/%E5%88%9D%E8%AF%86agentic-rag/ class=related-link>初识Agentic RAG</a></li></ul></div><div class=post-tags><a href=/tags/ai/ rel=tag class=post-tags-link><svg viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>AI</a>
<a href=/tags/llm/ rel=tag class=post-tags-link><svg viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>LLM</a></div><footer class=minimal-footer><div class=post-tag><a href=/tags/ai/ rel=tag class=post-tag-link>#ai</a> <a href=/tags/llm/ rel=tag class=post-tag-link>#llm</a></div><div class=post-category><a href=/code/ class=post-category-link>code</a></div></footer><ul class=post-nav><li class=post-nav-prev><a href=/code/plurai-ai-intellagent/ rel=prev>&lt; plurai-ai/intellagent 调研</a></li><li class=post-nav-next><a href=/code/graphrag/ rel=next>GraphRAG与LazyGraphRAG ></a></li></ul><div id=utterances></div></div></main><div id=back-to-top class=back-to-top><a href=#><svg viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info><span class=copyleft-symbol>🄯</span>&nbsp;©&nbsp;2017–2025&nbsp;<svg viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;Yuuki</div><div class=powered-by>Powered by <a href=https://github.com/gohugoio/hugo target=_blank rel=noopener>Hugo</a> | Theme is <a href=https://github.com/reuixiy/hugo-theme-meme target=_blank rel=noopener>MemE</a></div><div class=site-copyright><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a></div><div class=busuanzi-site-uv-and-pv><span id=busuanzi_container_site_uv>本站访客数&nbsp;<svg viewBox="0 0 448 512" class="icon busuanzi-site-uv"><path d="M224 256c70.7.0 128-57.3 128-128S294.7.0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2.0 422.4V464c0 26.5 21.5 48 48 48h352c26.5.0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"/></svg>&nbsp;<span id=busuanzi_value_site_uv></span></span>&nbsp;|&nbsp;<span id=busuanzi_container_site_pv>本站访问量&nbsp;<svg viewBox="0 0 576 512" class="icon busuanzi-site-pv"><path d="M288 144a110.94 110.94.0 00-31.24 5 55.4 55.4.0 017.24 27 56 56 0 01-56 56 55.4 55.4.0 01-27-7.24A111.71 111.71.0 10288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35.0 000 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35.0 000-29.19zM288 4e2c-98.65.0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 4e2 288 4e2z"/></svg>&nbsp;<span id=busuanzi_value_site_pv></span></span></div><ul class=socials><li class=socials-item><a href=/rss.xml target=_blank rel="external noopener" title=RSS><svg viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8.0 4.8V0c13.165.0 24 10.835 24 24h-4.801zM3.291 17.415c1.814.0 3.293 1.479 3.293 3.295.0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526.0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727.0 15.909 7.184 15.909 15.91z"/></svg></a></li><li class=socials-item><a href=mailto:chainyuuki@gmail.com target=_blank rel="external noopener" title=Email><svg viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 4e2V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V4e2H48z"/></svg></a></li><li class=socials-item><a href=https://github.com/needhourger target=_blank rel="external noopener" title=GitHub><svg viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></li><li class=socials-item><a href=https://twitter.com/yukiricc target=_blank rel="external noopener" title=Twitter><svg viewBox="0 0 512 512" class="icon social-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a></li><li class=socials-item><a href=https://t.me/Ceil_Chan target=_blank rel="external noopener" title=Telegram><svg viewBox="0 0 496 512" class="icon social-icon"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg></a></li></ul></div></footer></div><script>function loadComments(){(function(){const t=document.getElementById("utterances");if(!t)return;const e=document.createElement("script");e.src="https://utteranc.es/client.js",e.async=!0,e.crossOrigin="anonymous",e.setAttribute("repo","needhourger/needhourger.github.io"),e.setAttribute("issue-term","pathname");const n=getCurrentTheme()==="dark";n?e.setAttribute("theme","photon-dark"):e.setAttribute("theme","preferred-color-scheme"),e.setAttribute("label","💬"),t.appendChild(e)})()}</script><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script><script>let imgNodes=document.querySelectorAll("div.post-body img");imgNodes=Array.from(imgNodes).filter(e=>e.parentNode.tagName!=="A"),mediumZoom(imgNodes,{background:"hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)"})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script><script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script></body></html>